if(function(){var e,t,i,n,r,o,s,a,c,d,u,h,l,p,g,m,f,v,y,_=[].slice,w=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};(e=jQuery).payment={},e.payment.fn={},e.fn.payment=function(){var t,i;return i=arguments[0],t=2<=arguments.length?_.call(arguments,1):[],e.payment.fn[i].apply(this,t)},n=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:r=/(\d{1,4})/g,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:r,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:r,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:r,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:r,length:[13,14,15,16],cvcLength:[3],luhn:!0}],t=function(e){var t,i,r;for(e=(e+"").replace(/\D/g,""),i=0,r=n.length;i<r;i++)if((t=n[i]).pattern.test(e))return t},i=function(e){var t,i,r;for(i=0,r=n.length;i<r;i++)if((t=n[i]).type===e)return t},l=function(e){var t,i,n,r,o,s;for(n=!0,r=0,o=0,s=(i=(e+"").split("").reverse()).length;o<s;o++)t=i[o],t=parseInt(t,10),(n=!n)&&(t*=2),t>9&&(t-=9),r+=t;return r%10==0},h=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!("undefined"==typeof document||null===document||null==(t=document.selection)||"function"!=typeof t.createRange||!t.createRange().text)},p=function(t){return setTimeout(function(){var i,n;return i=e(t.currentTarget),n=i.val(),n=e.payment.formatCardNumber(n),i.val(n)})},a=function(i){var n,r,o,s,a,c,d;if(o=String.fromCharCode(i.which),/^\d+$/.test(o)&&(n=e(i.currentTarget),d=n.val(),r=t(d+o),s=(d.replace(/\D/g,"")+o).length,c=16,r&&(c=r.length[r.length.length-1]),!(s>=c||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==d.length)))return a=r&&"amex"===r.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,a.test(d)?(i.preventDefault(),n.val(d+" "+o)):a.test(d+o)?(i.preventDefault(),n.val(d+o+" ")):void 0},o=function(t){var i,n;if(i=e(t.currentTarget),n=i.val(),!t.meta&&8===t.which&&(null==i.prop("selectionStart")||i.prop("selectionStart")===n.length))return/\d\s$/.test(n)?(t.preventDefault(),i.val(n.replace(/\d\s$/,""))):/\s\d?$/.test(n)?(t.preventDefault(),i.val(n.replace(/\s\d?$/,""))):void 0},c=function(t){var i,n,r;if(n=String.fromCharCode(t.which),/^\d+$/.test(n))return i=e(t.currentTarget),r=i.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(t.preventDefault(),i.val("0"+r+" / ")):/^\d\d$/.test(r)?(t.preventDefault(),i.val(r+" / ")):void 0},d=function(t){var i,n,r;if(n=String.fromCharCode(t.which),/^\d+$/.test(n))return i=e(t.currentTarget),r=i.val(),/^\d\d$/.test(r)?i.val(r+" / "):void 0},u=function(t){var i,n;if("/"===String.fromCharCode(t.which))return i=e(t.currentTarget),n=i.val(),/^\d$/.test(n)&&"0"!==n?i.val("0"+n+" / "):void 0},s=function(t){var i,n;if(!t.meta&&(i=e(t.currentTarget),n=i.val(),8===t.which&&(null==i.prop("selectionStart")||i.prop("selectionStart")===n.length)))return/\d(\s|\/)+$/.test(n)?(t.preventDefault(),i.val(n.replace(/\d(\s|\/)*$/,""))):/\s\/\s?\d?$/.test(n)?(t.preventDefault(),i.val(n.replace(/\s\/\s?\d?$/,""))):void 0},v=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},m=function(i){var n,r,o,s;if(n=e(i.currentTarget),o=String.fromCharCode(i.which),/^\d+$/.test(o)&&!h(n))return s=(n.val()+o).replace(/\D/g,""),r=t(s),r?s.length<=r.length[r.length.length-1]:s.length<=16},f=function(t){var i,n,r;if(i=e(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!h(i))return r=i.val()+n,!((r=r.replace(/\D/g,"")).length>6)&&void 0},g=function(t){var i,n;if(i=e(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n))return(i.val()+n).length<=4},y=function(t){var i,r,o,s,a;if(i=e(t.currentTarget),a=i.val(),s=e.payment.cardType(a)||"unknown",!i.hasClass(s))return r=function(){var e,t,i;for(i=[],e=0,t=n.length;e<t;e++)o=n[e],i.push(o.type);return i}(),i.removeClass("unknown"),i.removeClass(r.join(" ")),i.addClass(s),i.toggleClass("identified","unknown"!==s),i.trigger("payment.cardType",s)},e.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",g),this},e.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",f),this.on("keypress",c),this.on("keypress",u),this.on("keypress",d),this.on("keydown",s),this},e.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",m),this.on("keypress",a),this.on("keydown",o),this.on("keyup",y),this.on("paste",p),this},e.payment.fn.restrictNumeric=function(){return this.on("keypress",v),this},e.payment.fn.cardExpiryVal=function(){return e.payment.cardExpiryVal(e(this).val())},e.payment.cardExpiryVal=function(e){var t,i,n;return e=e.replace(/\s/g,""),n=e.split("/",2),t=n[0],i=n[1],2===(null!=i?i.length:void 0)&&/^\d+$/.test(i)&&(i=(new Date).getFullYear().toString().slice(0,2)+i),t=parseInt(t,10),i=parseInt(i,10),{month:t,year:i}},e.payment.validateCardNumber=function(e){var i,n;return e=(e+"").replace(/\s+|-/g,""),!!/^\d+$/.test(e)&&(!!(i=t(e))&&(n=e.length,w.call(i.length,n)>=0&&(!1===i.luhn||l(e))))},e.payment.validateCardExpiry=function(t,i){var n,r,o;return"object"==typeof t&&"month"in t&&(t=(o=t).month,i=o.year),!(!t||!i)&&(t=e.trim(t),i=e.trim(i),!!/^\d+$/.test(t)&&(!!/^\d+$/.test(i)&&(parseInt(t,10)<=12&&(2===i.length&&(i=(new Date).getFullYear().toString().slice(0,2)+i),r=new Date(i,t),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>n))))},e.payment.validateCardCVC=function(t,n){var r,o;return t=e.trim(t),!!/^\d+$/.test(t)&&(n?(r=t.length,w.call(null!=(o=i(n))?o.cvcLength:void 0,r)>=0):t.length>=3&&t.length<=4)},e.payment.cardType=function(e){var i;return e?(null!=(i=t(e))?i.type:void 0)||null:null},e.payment.formatCardNumber=function(e){var i,n,r,o;return(i=t(e))?(r=i.length[i.length.length-1],e=e.replace(/\D/g,""),e=e.slice(0,+r+1||9e9),i.format.global?null!=(o=e.match(i.format))?o.join(" "):void 0:(null!=(n=i.format.exec(e))&&n.shift(),null!=n?n.join(" "):void 0)):e}}.call(this),Backbone.Validation=function(e){"use strict";var t={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},i={formatLabel:function(e,i){return c[t.labelFormatter](e,i)},format:function(){var e=Array.prototype.slice.call(arguments);return e.shift().replace(/\{(\d+)\}/g,function(t,i){return void 0!==e[i]?e[i]:t})}},n=function(t,i,r){return i=i||{},r=r||"",e.each(t,function(o,s){t.hasOwnProperty(s)&&(o&&e.isArray(o)?e.forEach(o,function(e,t){n(e,i,r+s+"."+t+"."),i[r+s+"."+t]=e}):o&&"object"==typeof o&&o.constructor===Object&&n(o,i,r+s+"."),i[r+s]=o)}),i},r=function(){var r=function(t,i){return i=i||e.keys(e.result(t,"validation")||{}),e.reduce(i,function(e,t){return e[t]=void 0,e},{})},s=function(t,i){var n=t.attributes;if(e.isFunction(n)?n=n(i):e.isString(n)&&e.isFunction(d[n])&&(n=d[n](i)),e.isArray(n))return n},a=function(t,i){var n=t.validation?e.result(t,"validation")[i]||{}:{};return(e.isFunction(n)||e.isString(n))&&(n={fn:n}),e.isArray(n)||(n=[n]),e.reduce(n,function(t,i){return e.each(e.without(e.keys(i),"msg"),function(e){t.push({fn:u[e],val:i[e],msg:i.msg})}),t},[])},c=function(t,n,r,o){return e.reduce(a(t,n),function(s,a){var c=e.extend({},i,u),d=a.fn.call(c,r,n,a.val,t,o);return!1!==d&&!1!==s&&(d&&!s?e.result(a,"msg")||d:s)},"")},h=function(t,i,n){var r,o={},s=!0,a=e.clone(i);return e.each(n,function(e,i){(r=c(t,i,e,a))&&(o[i]=r,s=!1)}),{invalidAttrs:o,isValid:s}},l=function(t,i){return{preValidate:function(t,i){var n,r=this,o={};return e.isObject(t)?(e.each(t,function(e,t){(n=r.preValidate(t,e))&&(o[t]=n)}),e.isEmpty(o)?void 0:o):c(this,t,i,e.extend({},this.attributes))},isValid:function(r){var o,a,d,u;return r=r||s(i,t),e.isString(r)?a=[r]:e.isArray(r)&&(a=r),a&&(o=n(this.attributes),e.each(this.associatedViews,function(t){e.each(a,function(n){(d=c(this,n,o[n],e.extend({},this.attributes)))?(i.invalid(t,n,d,i.selector),(u=u||{})[n]=d):i.valid(t,n,i.selector)},this)},this)),!0===r&&(u=this.validate()),u&&this.trigger("invalid",this,u,{validationError:u}),a?!u:!this.validation||this._isValid},validate:function(o,a){var c=this,d=!o,u=e.extend({},i,a),l=r(c,s(i,t)),p=e.extend({},l,c.attributes,o),g=n(p),m=o?n(o):g,f=h(c,p,e.pick(g,e.keys(l)));if(c._isValid=f.isValid,e.each(c.associatedViews,function(t){e.each(l,function(e,i){var n=f.invalidAttrs.hasOwnProperty(i),r=m.hasOwnProperty(i);n||u.valid(t,i,u.selector),n&&(r||d)&&u.invalid(t,i,f.invalidAttrs[i],u.selector)})}),e.defer(function(){c.trigger("validated",c._isValid,c,f.invalidAttrs),c.trigger("validated:"+(c._isValid?"valid":"invalid"),c,f.invalidAttrs)}),!u.forceUpdate&&e.intersection(e.keys(f.invalidAttrs),e.keys(m)).length>0)return f.invalidAttrs}}},p=function(t,i,n){i.associatedViews?i.associatedViews.push(t):i.associatedViews=[t],e.extend(i,l(t,n))},g=function(t,i){i&&t.associatedViews&&t.associatedViews.length>1?t.associatedViews=e.without(t.associatedViews,i):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},m=function(e){p(this.view,e,this.options)},f=function(e){g(e)};return{version:"0.11.3",configure:function(i){e.extend(t,i)},bind:function(i,n){var r=(n=e.extend({},t,o,n)).model||i.model,s=n.collection||i.collection;if(void 0===r&&void 0===s)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";r?p(i,r,n):s&&(s.each(function(e){p(i,e,n)}),s.bind("add",m,{view:i,options:n}),s.bind("remove",f))},unbind:function(t,i){var n=(i=e.extend({},i)).model||t.model,r=i.collection||t.collection;n?g(n,t):r&&(r.each(function(e){g(e,t)}),r.unbind("add",m),r.unbind("remove",f))},mixin:l(null,t)}}(),o=r.callbacks={valid:function(e,t,i){e.$("["+i+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(e,t,i,n){e.$("["+n+'~="'+t+'"]').addClass("invalid").attr("data-error",i)}},s=r.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},a=r.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},c=r.labelFormatters={none:function(e){return e},sentenceCase:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toUpperCase():" "+e.toLowerCase()}).replace(/_/g," ")},label:function(e,t){return t.labels&&t.labels[e]||c.sentenceCase(e,t)}},d=r.attributeLoaders={inputNames:function(e){var t=[];return e&&e.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===t.indexOf(this.name)&&t.push(this.name)}),t}},u=r.validators=function(){var t=String.prototype.trim?function(e){return null===e?"":String.prototype.trim.call(e)}:function(e){var t=/^\s+/,i=/\s+$/;return null===e?"":e.toString().replace(t,"").replace(i,"")},i=function(t){return e.isNumber(t)||e.isString(t)&&t.match(s.number)},n=function(i){return!(e.isNull(i)||e.isUndefined(i)||e.isString(i)&&""===t(i)||e.isArray(i)&&e.isEmpty(i))};return{fn:function(t,i,n,r,o){return e.isString(n)&&(n=r[n]),n.call(r,t,i,o)},required:function(t,i,r,o,s){var c=e.isFunction(r)?r.call(o,t,i,s):r;return!(!c&&!n(t))&&(c&&!n(t)?this.format(a.required,this.formatLabel(i,o)):void 0)},acceptance:function(t,i,n,r){if("true"!==t&&(!e.isBoolean(t)||!1===t))return this.format(a.acceptance,this.formatLabel(i,r))},min:function(e,t,n,r){if(!i(e)||e<n)return this.format(a.min,this.formatLabel(t,r),n)},max:function(e,t,n,r){if(!i(e)||e>n)return this.format(a.max,this.formatLabel(t,r),n)},range:function(e,t,n,r){if(!i(e)||e<n[0]||e>n[1])return this.format(a.range,this.formatLabel(t,r),n[0],n[1])},length:function(t,i,n,r){if(!e.isString(t)||t.length!==n)return this.format(a.length,this.formatLabel(i,r),n)},minLength:function(t,i,n,r){if(!e.isString(t)||t.length<n)return this.format(a.minLength,this.formatLabel(i,r),n)},maxLength:function(t,i,n,r){if(!e.isString(t)||t.length>n)return this.format(a.maxLength,this.formatLabel(i,r),n)},rangeLength:function(t,i,n,r){if(!e.isString(t)||t.length<n[0]||t.length>n[1])return this.format(a.rangeLength,this.formatLabel(i,r),n[0],n[1])},oneOf:function(t,i,n,r){if(!e.include(n,t))return this.format(a.oneOf,this.formatLabel(i,r),n.join(", "))},equalTo:function(e,t,i,n,r){if(e!==r[i])return this.format(a.equalTo,this.formatLabel(t,n),this.formatLabel(i,n))},pattern:function(e,t,i,r){if(!n(e)||!e.toString().match(s[i]||i))return this.format(a[i]||a.inlinePattern,this.formatLabel(t,r),i)}}}();return e.each(u,function(t,n){u[n]=e.bind(u[n],e.extend({},i,u))}),r}(_),function(e,t){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(i,n){return e.Marionette=e.Mn=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";!function(e,t){var i=e.ChildViewContainer;e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===i)return delete this._indexByCustom[t],!0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(n,function(e){i.prototype[e]=function(){var i=[t.values(this._views)].concat(t.toArray(arguments));return t[e].apply(t,i)}}),i}(0,t),e.ChildViewContainer.VERSION="0.1.7",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};e.Wreqr.VERSION="1.3.3",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){this.getCommands(e).instances.push(t)},clearCommands:function(e){this.getCommands(e).instances=[]}}),i}(),n.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var i=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,i):this.storage.addCommand(e,i)},_executeCommands:function(e,i,n){var r=this.storage.getCommands(e);t.each(r.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n,t),n.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){if(this.hasHandler(e))return this.getHandler(e).apply(this,t.rest(arguments))}})}(n,t),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(i){var n=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var r="vent"===e?"on":"setHandler";t.each(i,function(i,o){this[e][r](o,t.bind(i,n))},this)}}}),n}(),n.radio=function(e,t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,i,n){return function(r){var o=e._getChannel(r)[i];return o[n].apply(o,t.rest(arguments))}};return new i}(n,t),e.Wreqr}(t,i);var n=e.Marionette,r=e.Mn,o=t.Marionette={};o.VERSION="2.4.2",o.noConflict=function(){return e.Marionette=n,e.Mn=r,this},t.Marionette=o,o.Deferred=t.$.Deferred,o.extend=t.Model.extend,o.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},o.mergeOptions=function(e,t){e&&i.extend(this,i.pick(e,t))},o.getOption=function(e,t){if(e&&t)return e.options&&void 0!==e.options[t]?e.options[t]:e[t]},o.proxyGetOption=function(e){return o.getOption(this,e)},o._getValue=function(e,t,n){return i.isFunction(e)&&(e=n?e.apply(t,n):e.call(t)),e},o.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},o.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},o.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){return e[o.normalizeUIString(n,t)]=i,e},{})},o.normalizeUIValues=function(e,t,n){return i.each(e,function(r,s){i.isString(r)?e[s]=o.normalizeUIString(r,t):i.isObject(r)&&i.isArray(n)&&(i.extend(r,o.normalizeUIValues(i.pick(r,n),t)),i.each(n,function(e){var n=r[e];i.isString(n)&&(r[e]=o.normalizeUIString(n,t))}))}),e},o.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=[i.values(i.result(this,t))].concat(i.toArray(arguments));return i[n].apply(i,e)}})};var s=o.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},s._cache={},o._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,r,o){var s=arguments.length<3;s&&(r=(o=r)[0]);var a,c=n["on"+r.replace(t,e)];return i.isFunction(c)&&(a=c.apply(n,s?i.rest(o):o)),i.isFunction(n.trigger)&&(s+o.length>1?n.trigger.apply(n,s?o:[r].concat(i.drop(o,0))):n.trigger(r)),a}}(),o.triggerMethod=function(e){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(e){return(i.isFunction(e.triggerMethod)?e.triggerMethod:o.triggerMethod).apply(e,i.rest(arguments))},o.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,r()}function n(){e._isRendered=!0,r()}function r(){e._isShown&&e._isRendered&&o.isNodeAttached(e.el)&&i.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}e.on({show:t,render:n})},function(e){function t(t,n,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=t[i];if(!o)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,r,o)})}function n(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];e.stopListening(t,n,r)})}function o(e,t,i,n){e.stopListening(t,i,n)}function s(t,n,r,o,s){if(n&&r){if(!i.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),i.each(r,function(e,r){i.isFunction(e)?o(t,n,r,e):s(t,n,r,e)})}}e.bindEntityEvents=function(e,i,r){s(e,i,r,n,t)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,o,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o);var a=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(e,t){i.isObject(e)?e=(t=e).message:t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,a),i.pick(t,a)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption}),o.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,t.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e);var n=t||{},r=e!==this.currentView,s=!!n.preventDestroy,a=!!n.forceShow,c=!!this.currentView,d=r&&!s,u=r||a;if(c&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,d?this.empty():c&&u&&this.currentView.off("destroy",this.empty,this),u){e.once("destroy",this.empty,this),e.render(),e._parent=this,c&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),o.triggerMethodOn(e,"before:show",e,this,t),c&&this.triggerMethod("swapOut",this.currentView,this,t);var h=o.isNodeAttached(this.el),l=[],p=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return h&&p.triggerBeforeAttach&&(l=this._displayedViews(e),this._triggerAttach(l,"before:")),this.attachHtml(e),this.currentView=e,h&&p.triggerAttach&&(l=this._displayedViews(e),this._triggerAttach(l)),c&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),o.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){o.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,o._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=o._getValue(e,"preventDestroy",this);if(t)return t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),i||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,i&&this.$el.contents().detach(),this},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&(e.remove(),e.isDestroyed=!0)},attachView:function(e){return this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,r=i.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new n(r)},_buildRegionFromRegionClass:function(e){return new e}}),o.RegionManager=o.Controller.extend({constructor:function(e){this._regions={},this.length=0,o.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=o._getValue(e,this,arguments),i.reduce(e,function(e,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[r]=this.addRegion(r,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof o.Region?t:o.Region.buildRegion(t,o.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new o.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,i){var n=t.$(e).html();if(!n||0===n.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return n},compileTemplate:function(e,t){return i.template(e,t)}}),o.Renderer={render:function(e,t){if(!e)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(i.isFunction(e)?e:o.TemplateCache.get(e))(t)}},o.View=t.View.extend({isDestroyed:!1,constructor:function(e){i.bindAll(this,"render"),e=o._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=o.Behaviors(this),t.View.call(this,this.options),o.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=o._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e,t){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return o.normalizeUIValues(e,r||n,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=o._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),c=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,a,c),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.isObject(e),n=i.defaults({},t?e:{},{preventDefault:!0,stopPropagation:!0}),r=t?n.event:e;return function(e){e&&(e.preventDefault&&n.preventDefault&&e.preventDefault(),e.stopPropagation&&n.stopPropagation&&e.stopPropagation());var t={view:this,model:this.model,collection:this.collection};this.triggerMethod(r,t)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=o._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=o._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;n<r;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var n=this._parentLayoutView();if(n){var r=o.getOption(n,"childViewEventPrefix")+":"+e;o._triggerMethod(n,[r,this].concat(t));var s=o.getOption(n,"childEvents"),a=n.normalizeMethods(s);a&&i.isFunction(a[e])&&a[e].apply(n,[this].concat(t))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_getAncestors:function(){for(var e=[],t=this._parent;t;)e.push(t),t=t._parent;return e},_parentLayoutView:function(){var e=this._getAncestors();return i.find(e,function(e){return e instanceof o.LayoutView})},normalizeMethods:o.normalizeMethods,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(!1!==e){if(!e)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=o.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&o.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,n){var r=i.drop(arguments,3);i.each(e,function(e){o.triggerMethodOn.apply(e,[e,n,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,n){var r;if(r=void 0!==n.at?n.at:i.indexOf(this._filteredSortedModels(),e),this._shouldAddChild(e,r)){this.destroyEmptyView();var o=this.getChildView(e);this.addChild(e,o,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){o.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){o.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels();if(i.find(t,function(t){return!e.findByModel(t)}))this.render();else{var n=i.map(t,function(t,i){var n=e.findByModel(t);return n._index=i,n.el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(n),this.triggerMethod("reorder")}},resortView:function(){o.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels();i.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();i.each(t,function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},_filteredSortedModels:function(){var e,t=this.getViewComparator();return e=t?i.isString(t)||1===t.length?this.collection.sortBy(t,this):i.clone(this.collection.models).sort(i.bind(t,this)):this.collection.models,this.getOption("filter")&&(e=i.filter(e,function(e,t){return this._shouldAddChild(e,t)},this)),e},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n,r=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(s)&&(s=s.call(this,e,this._emptyViewIndex));var a=this.buildChildView(e,t,s);a._parent=this,this.proxyChildEvents(a),this._isShown&&o.triggerMethodOn(a,"before:show",a),this.children.add(a),r&&this._triggerBeforeAttach&&(n=[a].concat(a._getNestedViews()),a.once("render",function(){this._triggerMethodMany(n,this,"before:attach")},this)),this.renderChildView(a,this._emptyViewIndex),r&&this._triggerAttach&&(n=[a].concat(a._getNestedViews()),this._triggerMethodMany(n,this,"attach")),this._isShown&&o.triggerMethodOn(a,"show",a)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,i){this.getOption("sort")&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el);this.proxyChildEvents(e),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"before:show",e),this.children.add(e),n&&this._triggerBeforeAttach&&(i=[e].concat(e._getNestedViews()),e.once("render",function(){this._triggerMethodMany(i,this,"before:attach")},this)),this.renderChildView(e,t),n&&this._triggerAttach&&(i=[e].concat(e._getNestedViews()),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.render(),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){return new t(i.extend({model:e},n))},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return i.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i;return this.getOption("sort")&&t<this.children.length-1&&(i=this.children.find(function(e){return e._index===t+1})),!!i&&(i.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(t.checkEmpty)||(n=t.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),void 0!==o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){return this.getOption("childView")||this.constructor},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){this.getChildViewContainer(e).append(t)},_insertAfter:function(e){this.getChildViewContainer(this,e).append(e.el)},_appendReorderedChildren:function(e){this.getChildViewContainer(this).append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var i,n=o.getOption(e,"childViewContainer");if(n){var r=o._getValue(n,e);if((i="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r)).length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(!0===this.getOption("destroyImmediate")&&this.$el.remove(),this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t){return this.getRegion(e).show(t)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=o._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=o._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),this.ui=i.extend({},i.result(t,"ui"),i.result(this,"ui")),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),o.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(s)),n):{}}function n(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){return new n(this,t).buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={};return t.each(n,function(i,n){var a={},c=t.clone(t.result(i,"events"))||{};c=e.normalizeUIKeys(c,r(i));var d=0;t.each(c,function(e,r){var s=r.match(o),c=s[1]+"."+[this.cid,n,d++," "].join("")+s[2],u=t.isFunction(e)?e:i[e];a[c]=t.bind(u,i)},this),s=t.extend(s,a)},this),s}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var o=new(i.getBehaviorClass(n,r))(n,e),s=i.parseBehaviors(e,t.result(o,"behaviors"));return[o].concat(s)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(s[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=t.clone(t.result(i,"triggers"))||{};o=e.normalizeUIKeys(o,r(i)),t.each(o,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var r=e[n];if(!r)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(r,e))},mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),o.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=o.Module.getClass(t),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=o.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var r=e,o=i.drop(arguments,3),s=(t=t.split(".")).length,a=[];return a[s-1]=n,i.each(t,function(t,i){var s=r;r=this._getModule(s,t,e,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(e,t,n,r,o){var s=i.extend({},r),a=this.getClass(r),c=e[t];return c||(c=new a(t,n,s),e[t]=c,e.submodules[t]=c),c},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,o)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,!!i.isUndefined(n)||n):!i.isObject(e)||(n=e.startWithParent,!!i.isUndefined(n)||n)},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o}),function(e){function t(){a(document.getElementsByTagName("input"),r),e.setTimeout(function(){h.find("input").checkAndTriggerAutoFillEvent()},200)}function i(){var e,t;for(e=0;e<this.length;e++)n(t=this[e])||(r(t),c(t))}function n(e){"$$currentValue"in e||(e.$$currentValue=e.getAttribute("value"));var t=e.value,i=e.$$currentValue;return!t&&!i||t===i}function r(e){e.$$currentValue=e.value}function o(e,t){function i(e){var i=e.target;t(i)}u.addEventListener?u.addEventListener(e,i,!0):u.attachEvent(e,i)}function s(e){for(;e;){if("FORM"===e.nodeName)return d(e);e=e.parentNode}return d()}function a(e,t){if(e.forEach)return e.forEach(t);var i;for(i=0;i<e.length;i++)t(e[i])}function c(t){var i=e.document.createEvent("HTMLEvents");i.initEvent("change",!0,!0),t.dispatchEvent(i)}var d=e.jQuery||e.angular.element,u=e.document.documentElement,h=d(u);o("change",r),function(t){var i=(e.jQuery||e.angular.element).prototype,n=i.val;i.val=function(e){var i=n.apply(this,arguments);return arguments.length>0&&a(this,function(i){t(i,e)}),i}}(r),d.prototype.checkAndTriggerAutoFillEvent=i,o("blur",function(t){e.setTimeout(function(){s(t).find("input").checkAndTriggerAutoFillEvent()},20)}),e.document.addEventListener?e.document.addEventListener("DOMContentLoaded",t,!1):e.document.attachEvent("DOMContentLoaded",t)}(window),void 0===cure)cure={};if(cure.donate=cure.donate||{},cure.donate.models=function(){var e={};return e.stripeCard=Backbone.Model.extend({initialize:function(e){this.on("change:name",this.parseName),this.on("change:exp",this.parseExpiry),this.on("change:currency_code",this.setCurrencySymbol),cure.donate.app.vent.on("toggle:cvc:requirement",this.toggleCvcRequirement,this)},defaults:{amount:"0",number:"",exp:"",exp_month:"",exp_year:"",name:"",address_line1:"",address_line2:"",address_state:"",address_zip:"",address_country:"",currency:"usd",currency_symbol:"$",cvc:"",card:"",token:"",subscription:!1,buttonText:"",email:"",zip:"",address1:"",address2:"",city:"",state:"",zip:"",phone:""},toggleCvcRequirement:function(e){e?this.validation.cvc={required:!0,pattern:"digits",msg:"Please provide a valid security code"}:delete this.validation.cvc},parseName:function(e,t){var i;t.length>1&&(i=NameParse.parse(t),this.set({first_name:i.firstName,last_name:i.lastName}))},parseExpiry:function(e,t){var i;_.isUndefined(t)||"string"!=typeof t||(t=cure.parseAndroidExpiry(t),i=$.payment.cardExpiryVal(t),this.set({exp_month:i.month,exp_year:i.year}))},setCurrencySymbol:function(e,t){var i="$";"gbp"===t&&(i=""),this.set({currency_symbol:i})},prepare:function(){var e={},t=["cvc","number","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"];return""===this.get("cvc")&&this.unset("cvc"),""!==this.get("zip")?this.set({address_zip:this.get("zip")}):this.unset("address_zip"),_.each(this.attributes,function(i,n,r){_.contains(t,n)&&(e[n]=i)},this),e},validation:{amount:function(e){var t=parseInt(cure.donate.app.options.giftMinimum,10)||5,i=parseInt(e,10);if(!_.isNumber(i)||i<parseInt(t,10))return"Minimum donation is $"+t},email:{required:!0,pattern:"email",msg:"Please provide a valid E-mail address"},last_name:function(e){if(_.isUndefined(e)||_.isEmpty(e))return"Please provide your last name"},number:function(e){if(!cure.donate.app.donation.get("test")&&!$.payment.validateCardNumber(e))return"Please check your card number"},exp:function(e){var t;if(!_.isUndefined(e)&&(e=cure.parseAndroidExpiry(e),t=$.payment.cardExpiryVal(e),!$.payment.validateCardExpiry(t.month,t.year))){if(navigator.userAgent.match(/Android/i)){return"We apologize, our auto-formatting for the card expiration field does not work on Android.                                 Please check the card expiration field and format it to match 'MM/YY' or 'MM/YYYY'.                                 Important: Include a slash between Month and Year."}return"Please check your card's expiration"}},cvc:{required:!0,pattern:"digits",msg:"Please provide a valid security code"}}}),e.GiftCard=Backbone.Model.extend({initialize:function(){},url:"/curekids/giftcard/fulfill",defaults:{name:"",first_name:"",last_name:"",gcnumber:"",profile_id:"",email:""},validation:{email:{required:!0,pattern:"email",msg:"Please provide a valid E-mail address"},name:function(e){var t=e.split(" ");return t.length<=1?"Please provide your last name":t.length<1?"Please provide your name":void 0},gcnumber:{required:!0,msg:"Please check your Gift Code"}}}),e.CureDonation=Backbone.Model.extend({initialize:function(){this.on("change:name",this.parseName),this.on("change:recipient_name",this.dedicationDescription),this.on("change:dedication_type",this.dedicationDescription),this.on("change:frequency",function(e,t){"monthly"===t?e.set({from_recurring:!0,is_monthly:!0}):e.set({from_recurring:!1,is_monthly:!1})})},defaults:{test:!1,fund:"",description:"",paymentType:"",campaign:"",campaign_id:"",campaignType:"",comment:"",private:"",consent_to_share:"",profile_id:"",relationship_action:"",community_id:"",condition_id:"",token:"",card:"",currency:"usd",transactionId:"",xtransaction_id:"",user_id:"",first_name:"",last_name:"",email:"",address1:"",address2:"",city:"",state:"",zip:"",country:"",phone:"",check_date:"",check_number:"",batch:"",event_date:"",recipient_name:"",recipient_email:"",dedication_type:"",gift_source:"",from_cc:"",from_event_form:"",is_monthly:!1,incentive_item_flag:"",incentive_item_name:""},url:function(){return"/wp-json/cure/v1/donate/"+this.get("paymentType")},dedicationDescription:function(e,t){this.set({description:e.get("dedication_type")+" "+e.get("recipient_name")})},parseName:function(e,t){var i;t.length>=3&&(i=NameParse.parse(t),this.set({first_name:i.firstName,last_name:i.lastName}))},success:function(e,t){},validation:{email:{required:!0,pattern:"email",msg:"Please provide a valid E-mail address"},name:{required:!0,msg:"Please provide your name"}}}),e.Ask=Backbone.Model.extend({initialize:function(){},defaults:{order:"",currency:"usd",amount:"",frequency:"",label:"",sublabel:"",active:!0}}),e.DonationMessageModel=Backbone.Model.extend({}),e.Curekid=Backbone.Model.extend({defaults:{profile_id:"",xprofile_id:"",shortname:"",fullname:"",mothers_name:"",description:"",gender:"",next_date:"",birth_date:"",create_date:"",ttimestamp:"",created_by:"",modified_by:"",friendly_uri:"",header_photo_url:"",profile_photo_url:"",after_photo_url:"",before_photo_url:"",qrcode_photo_url:"",country_id:"",condition_id:"",publish_status:"",in_hospital_flag:"",archived_flag:"",hide_after_flag:"",oldprofile_idclinic_name:"",internal_notes:"",contact_details:"",story_text:"",story_rating:"",story_usage:"",sm_story:"",sm_headline:"",sm_month:"",c_status_id:"",p_community_id:"",c_procedure_id:"",post_id:"",published_date:"",published_by:"",medrec_reference:"",funded_flag:"",header_photo_id:"",profile_photo_id:"",after_photo_id:"",before_photo_id:"",country_term:"",condition_term:"",age:""}}),e}(),cure.donate.collections=function(){var e={};return e.Curekids=Backbone.Collection.extend({model:cure.donate.models.Curekid}),e}(),void 0===cure)cure={};if(cure.donate=cure.donate||{},cure.donate.views=function(){var e={};return e.fullLayout=Backbone.Marionette.LayoutView.extend({template:"#FullLayout",initialize:function(){},regions:function(){var e={},t=[1,2,"2-2",3,4,5,6,7,8,9,10,11,12,13];return _.each(t,function(t,i){e["zone"+t]="#zone-"+t},this),e}}),e.widgetLayout=Backbone.Marionette.LayoutView.extend({initialize:function(){},template:"#WidgetLayout",regions:{widgetHeader:"#WidgetHeader",widgetError:"#WidgetError",widgetForm:"#WidgetForm",widgetSubmit:"#WidgetSubmit",widgetFooter:"#WidgetFooter"},events:{"click #more-options":"showMoreOptions"},showMoreOptions:function(e){var t,i,n;e.preventDefault(),i=function(){$("body").addClass("modal-active"),$(".modal-container").addClass("active"),animate({el:".modal-container",opacity:[0,1],easing:"easeOutQuart",duration:700}),animate({el:".giving-option-1",opacity:[0,1],translateY:[-100,0],rotateX:[20,0],easing:"easeOutBack",delay:450,duration:360}),animate({el:".giving-option-2",opacity:[0,1],translateY:[-100,0],rotateX:[20,0],easing:"easeOutBack",delay:500,duration:360}),animate({el:".giving-option-3",opacity:[0,1],translateY:[-100,0],rotateX:[20,0],easing:"easeOutBack",delay:550,duration:360}),animate({el:".close-modal-trigger",opacity:[0,1],translateX:[100,0],easing:"easeOutQuart",delay:900,duration:800})},n=function(){animate({el:".modal-container",opacity:[1,0],easing:"easeOutQuart",duration:400,complete:function(){$(".modal-container").removeClass("active"),$("body").removeClass("modal-active"),animate({el:".giving-option-1",opacity:[1,0],trcanslateY:[0,-20],easing:"easeOutBack",delay:0,duration:100}),animate({el:".giving-option-2",opacity:[1,0],translateY:[0,-20],easing:"easeOutBack",delay:0,duration:100}),animate({el:".giving-option-3",opacity:[1,0],translateY:[0,-20],easing:"easeOutBack",delay:0,duration:100}),animate({el:".close-modal-trigger",opacity:[1,0],translateX:[0,100],easing:"easeOutQuart",delay:0,duration:100})}})},t=new cure.donate.models.Ask({amount:"100",currency:"usd",frequency:"monthly",type:"any"}),i(),$(".close-modal-trigger").click(function(){n()}),$("input[name=frequency]").click(function(e){t.set({frequency:e.currentTarget.value})}),$("input[name=any-ask-amount]").change(function(e){t.set({amount:e.currentTarget.value})}),$("input[name=any-ask-amount]").change(function(e){var t=e.currentTarget.value;$("input[name=any-ask-amount]").val(t)}),$(".giving-option.giving-option-1 > a.btn-secondary").click(function(e){e.preventDefault(),cure.donate.app.vent.trigger("user:clicked:ask",new cure.donate.models.Ask({amount:"38",currency:"usd",frequency:"monthly",type:"preset"})),n()}),$(".giving-option.giving-option-2 > a.btn-secondary").click(function(e){e.preventDefault(),cure.donate.app.vent.trigger("user:clicked:ask",new cure.donate.models.Ask({amount:"1000",currency:"usd",frequency:"once",type:"preset"})),n()}),$(".giving-option.giving-option-3 > a.btn-secondary").click(function(e){e.preventDefault(),t.set({amount:$("input[name=any-ask-amount]").first().val()}),cure.donate.app.vent.trigger("user:clicked:ask",t),n()})}}),e.widgetLayoutTop=Backbone.Marionette.ItemView.extend({initialize:function(){},template:"#WidgetLayoutTop",events:{click:"mySuperCoolAnimation","change select":function(e){var t=e.currentTarget.name,i=e.currentTarget.value,n={};n[t]=i,this.model.set(n),"frequency"!==t&&"currency"!==t&&"amount"!==t||cure.donate.app.vent.trigger("changed:ask:field",this.model.attributes),cure.donate.app.vent.trigger("donation:data:change",n)}},onShow:function(){$(".explanation-close-button").click(function(e){e.preventDefault(),$(".ck-profile-container").toggleClass("financial-explanation-active",1e3),$(".ck-profile-giving-explanation-container").toggleClass("active")})},mySuperCoolAnimation:function(){$(".ck-profile-container").toggleClass("financial-explanation-active",1e3),$(".ck-profile-giving-explanation-container").toggleClass("active")},templateHelpers:{selected:function(e,t){return this[e]===t?'selected="selected"':""}}}),e.widgetLayoutBottom=Backbone.Marionette.ItemView.extend({template:"#WidgetLayoutBottom",onShow:function(){_.isUndefined($.tosrus)||$(".hero-video-trigger").tosrus({keys:{close:!0}})}}),e.navItem=Backbone.Marionette.ItemView.extend({template:"#NavItem",triggers:{click:"change:payment:type"}}),e.navMenu=Backbone.Marionette.CollectionView.extend({initialize:function(){this.on("childview:change:payment:type",this.toggleActive)},template:"#NavMenu",childView:e.navItem,tagName:"ul",className:"nav nav-tabs",toggleActive:function(e){this.$el.find(".active").removeClass("active"),e.$el.find("li").addClass("active"),cure.donate.app.vent.trigger("change:payment:type",e.model)}}),e.Message=Backbone.Marionette.ItemView.extend({template:"#Message",onShow:function(){}}),e.Form=Backbone.Marionette.ItemView.extend({initialize:function(){cure.donate.app.vent.on("user:clicked:ask",this.userClickedAsk,this),cure.donate.app.vent.on("donation:data:change",function(e){_.isUndefined(this.model)||this.model.set(e),_.isUndefined(this.logging)||this.logging(e)},this),cure.donate.app.vent.on("donation:submit",this.submit,this)},onAttach:function(){$('input[type="text"], input[type="email"]').blur(function(){0!=$(this).val().length?$(this).siblings("label").addClass("input-has-text"):$(this).siblings("label").removeClass("input-has-text")})},onRender:function(){this.$el.find("input[name=exp]").length>0&&this.$el.find("input[name=exp]").payment("formatCardExpiry"),this.$el.find("input[name=number]").length>0&&this.$el.find("input[name=number]").payment("formatCardNumber"),this.$el.find("input[name=amount]").length>0&&this.$el.find("input[name=amount]").payment("restrictNumeric"),this.$el.find("input[name=zip]").length>0&&this.$el.find("input[name=zip]").payment("restrictNumeric"),this.$el.find("input[name=cvc]").length>0&&this.$el.find("input[name=cvc]").payment("formatCardCVC"),this.$el.checkAndTriggerAutoFillEvent(),Backbone.Validation.bind(this)},events:{keyup:function(e){13!==e.which&&10!==e.which||cure.donate.app.vent.trigger("donation:submit")},'click [type="checkbox"]':function(e){var t=e.target.name,i=(e.target.value,{});i[t]=e.target.checked,"incentive_item_flag"===t&&(i.incentive_item_flag=!i.incentive_item_flag),i.is_monthly?i.frequency="monthly":i.frequency="once",this.model.set(i),cure.donate.app.vent.trigger("donation:data:change",i)},input:function(e){var t=e.target.name,i=e.target.value,n={};n[t]=i,"checkbox"===e.target.type?n[t]=e.target.checked:n[t]=i,this.model.set(n),cure.donate.app.vent.trigger("donation:data:change",n)},"change select":function(e){var t=e.currentTarget.name,i=e.currentTarget.value,n={};n[t]=i,this.model.set(n),"frequency"!==t&&"currency"!==t||cure.donate.app.vent.trigger("changed:ask:field",{currency:this.model.get("currency"),frequency:this.model.get("frequency")}),cure.donate.app.vent.trigger("donation:data:change",n)},"keyup input[name=amount]":function(e){var t={amount:e.currentTarget.value};this.model.set(t),cure.donate.app.vent.trigger("changed:ask:field",{amount:this.model.get("amount")}),cure.donate.app.vent.trigger("donation:data:change",t)}},userClickedAsk:function(e){var t=_.pick(e.attributes,["amount","currency","frequency"]);cure.donate.app.vent.trigger("donation:data:change",t),this.model.set(t),this.render()},displayMessage:function(t){var i,n=t.get("message");n&&t.set({message:n.replace(/support@stripe.com/g,"donor.support@cure.org")}),i=new e.Message({model:t}),cure.donate.app.vent.trigger("show:message",i)},templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),_.extend(e,{getEventDate:function(){return cure.donate.app.donation.get("event_date")},getStates:function(){return cure.donate.app.States},getShirtSizes:function(){return["Small","Medium","Large","X-Large","XX-Large"]}}),e}}),e.StripeForm=e.Form.extend({getTemplate:function(){return"widget"===cure.donate.app.options.displayStyle?"#WidgetStripeForm":"hero"===cure.donate.app.options.displayStyle?"#HeroStripeForm":"#StripeForm"},submit:function(){var e;"stripe"===cure.donate.app.donation.get("paymentType")&&(cure.donate.app.vent.trigger("change:submit:button","Processing...please wait."),this.model.set(cure.donate.app.donation.attributes),e=this.model.prepare(),this.model.isValid(!0)?($("#donate_please_wait").modal({show:!0,keyboard:!1,backdrop:"static"}),Stripe.card.createToken(e,_.bind(this.stripeResponseHandler,this))):(cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button")))},stripeResponseHandler:function(e,t){var i=new cure.donate.models.DonationMessageModel,n=!0,r=["AE","AU","BR","CA","CN","IN","DE","DK","FR","GB","GT","ID","IL","ME","NL","NO","PH","SE","TH","TT","US","UK","ZA"];200===e?!_.isUndefined(t.card)&&(r.indexOf(t.card.country)>=0||null===t.card.country)?(cure.donate.app.donation.get("amount")>=2e3&&(n=confirm("Please Confirm your donation amount: $"+cure.donate.app.donation.get("amount"))),n?this.saveStripeDonation(t):(cure.donate.app.vent.trigger("recently:submitted",!1),$("#donate_please_wait").modal("hide"))):(i.set({type:"Unknown Card Origin",message:"At this time we are not allowing credit cards from "+t.card.country+". Please contact donor.support@cure.org for more information."}),this.displayMessage(i)):($("#donate_please_wait").modal("hide"),_.isUndefined(t.error)?i.set({type:"unknown",message:"An Unknown Error Occurred."}):i.set({type:t.error.code,message:t.error.message}),this.displayMessage(i)),cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button")},saveStripeDonation:function(e){var t=cure.donate.app.donation.get("number"),i=cure.donate.app.donation.get("exp");cure.donate.app.donation.set({token:e.id,card:e.card.id,paymentType:"stripe",number:!1,exp:!1}),cure.donate.app.donation.save({},{success:_.bind(function(e,n,r){$("#donate_please_wait").modal("hide");var o,s=r.xhr,a=new cure.donate.models.DonationMessageModel({type:"Stripe"}),c="/donate/thankyou?";c+="donation=",201===s.status?(c+=n.xtransaction_id,document.location.href=c+"#mailing-address"):(500===s.status?o="Cure.org Server Error, please contact donor.support@cure.org":_.indexOf(s.status,"4")&&(o="Error: "+n.error.message),a.set({message:o}),cure.donate.app.donation.set({number:t,exp:i}),cure.donate.app.vent.trigger("recently:submitted",!1),this.displayMessage(a),cure.donate.app.vent.trigger("change:submit:button"))},this),error:_.bind(function(e,t,i){$("#donate_please_wait").modal("hide");var n=new cure.donate.models.DonationMessageModel({type:"Server",message:"There was a problem reaching Cure.org, please try again in 5 minutes."});cure.donate.app.vent.trigger("recently:submitted",!1),this.displayMessage(n),cure.donate.app.vent.trigger("change:submit:button")},this)})}}),e.GiftCardForm=e.Form.extend({template:"#GiftCardForm",submit:function(){"giftcard"===cure.donate.app.donation.get("paymentType")&&(cure.donate.app.vent.trigger("change:submit:button","Processing...please wait."),cure.donate.app.donation.set({number:"",exp:""}),this.model.set(cure.donate.app.donation.attributes),this.model.isValid(!0)?($("#donate_please_wait").modal({show:!0,keyboard:!1,backdrop:"static"}),this.model.save({},{type:"post",success:_.bind(this.successResponseHandler,this),error:_.bind(this.errorResponseHandler,this)})):(cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button")))},successResponseHandler:function(e,t,i){var n;i.xhr;n=new cure.donate.models.DonationMessageModel({type:"GiftCard"}),t.error&&(n.set({message:t.error}),cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button")),!0===t.success&&(_.isUndefined(t.credit.fulfillment_status)||1!==t.credit.fulfillment_status?n.set({message:"There was a problem redeeming your Gift Card, please contact donor.support@cure.org"}):n.set({message:"Successfully redeemed Gift Card"})),this.displayMessage(n)},errorResponseHandler:function(e,t,i){var n;i.xhr;_.isUndefined(t.error)?n=new cure.donate.models.DonationMessageModel({type:"unknown",message:"An Unknown Error Occurred."}):(n=new cure.donate.models.DonationMessageModel({type:t.error.code,message:t.error.message}),cure.donate.app.vent.trigger("change:submit:button")),cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button"),this.displayMessage(n)}}),e.CashForm=e.Form.extend({template:"#CashGiftForm",onRender:function(){this.$el.find("#check-date-input").datepicker({dateFormat:"yy-mm-dd",onClose:function(e,t){cure.donate.app.vent.trigger("donation:data:change",{check_date:e})}}),Backbone.Validation.bind(this)},paymentType:"cash",submit:function(){cure.donate.app.donation.get("paymentType")===this.paymentType&&(this.model.set({number:!1,exp:!1,xtransaction_id:this.model.get("nonce")+this.model.get("gentime")}),cure.donate.app.vent.trigger("change:submit:button","Processing...please wait."),this.model.isValid(!0)?($("#donate_please_wait").modal({show:!0,keyboard:!1,backdrop:"static"}),this.model.save({},{success:_.bind(this.successResponseHandler,this),error:_.bind(this.errorResponseHandler,this)})):(cure.donate.app.vent.trigger("recently:submitted",!1),cure.donate.app.vent.trigger("change:submit:button")))},successResponseHandler:function(e,t,i){var n,r=new cure.donate.models.DonationMessageModel({type:"Cash"}),o="/donate/thankyou?";cure.donate.app.donation.get("campaign").match(/team tomlin/i)?o+="goal=teamtomlin&donation=":o+="donation=",!_.isUndefined(t.id)&&parseInt(t.id,10)>0?(o+=t.xtransaction_id,document.location.href=o+"#mailing-address"):(500===t.status?n="Cure.org Server Error":_.indexOf(t.status,"4")&&(n="Error: "+t.error.message),r.set({message:n}),cure.donate.app.vent.trigger("recently:submitted",!1),this.displayMessage(r))},errorResponseHandler:function(e,t,i){$("#donate_please_wait").modal("hide");var n=new cure.donate.models.DonationMessageModel({type:"Server",message:"There was a problem reaching Cure.org, please try again in 5 minutes."});cure.donate.app.vent.trigger("recently:submitted",!1),this.displayMessage(n)}}),e.AmountView=e.Form.extend({template:"#Amount",templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),e}}),e.FrequencyView=e.Form.extend({template:"#Frequency",templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),e}}),e.CureExtrasForm=e.Form.extend({template:"#CureExtrasForm",initialize:function(){this.model.on("change",function(e,t){_.isEmpty(_.pick(e.attributes,["amount","currency","frequency"]))||this.toggleRetailOffer()},this)},toggleRetailOffer:function(){var e=this.$el.find("#shirt-selection");e.length>0&&(this.model.get("amount")>=this.model.get("retail_threshold")?e.show():e.hide())},templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),_.extend(e,{getShirtSizes:function(){return["Small","Medium","Large","X-Large","XX-Large"]}}),e}}),e.SubmitView=Backbone.Marionette.ItemView.extend({template:"#DonateSubmit",initialize:function(){this.recentlyClicked=!1,cure.donate.app.vent.on("recently:submitted",function(e){this.recentlyClicked=e}),this.model.on("change",function(e,t){_.isEmpty(_.pick(e.attributes,["amount","currency","frequency"]))||this.changeSubmitButton()},this),cure.donate.app.vent.on("change:submit:button",this.changeSubmitButton,this)},onAttach:function(){this.changeSubmitButton()},changeSubmitButton:function(e){_.isUndefined(this.model)||(_.isUndefined(e)?(this.buttonTextString="Donate "+this.model.get("currency_symbol")+this.model.get("amount"),"monthly"===this.model.get("frequency")&&(this.buttonTextString+=" a month")):this.buttonTextString=e,this.$el.find("input[name=donate-submit]").length>0&&this.$el.find("input[name=donate-submit]").val(this.buttonTextString))},events:{"click input[name=donate-submit]":function(e){e.preventDefault(),cure.donate.app.vent.trigger("donation:submit")}}}),e.AskItem=Backbone.Marionette.ItemView.extend({initialize:function(){this.active=!0},template:"#AskItem",className:function(){var e="giving-option";return!0===this.model.get("selected")&&(e+=" selected"),e},triggers:{click:"ask:click"},templateHelpers:{getClasses:function(){var e=[""];return"super hero"===this.label&&e.push("cure-super-hero-label"),"hero"===this.label&&e.push("cure-hero-label"),"Any Amount"===this.label&&e.push("any-amount-label"),e},isDisabled:function(){return!1===this.active?"disabled=disabled":""}}}),e.AsksCollectionView=Backbone.Marionette.CompositeView.extend({initialize:function(){this.model=new Backbone.Model(cure.donate.app.donation.get("profile")),this.activeView={},this.on("childview:ask:click",this.userSelectedAsk),cure.donate.app.vent.on("changed:ask:field",this.syncAskSelection,this),cure.donate.app.vent.on("hide:monthly:asks",this.disableMonthly,this),cure.donate.app.vent.on("show:monthly:asks",this.enableMonthly,this)},template:"#DonateAsks",childViewContainer:"div",childView:e.AskItem,className:"giving-options",onRender:function(){!1===cure.donate.app.options.showAsks&&this.$el.find(".giving-option").hide()},disableMonthly:function(){var e=!1,t=!1;this.children.each(function(i){var n=i.model.get("frequency");_.isUndefined(n)||"monthly"!==n?t||(t=i):(i.model.set({active:!1}),(this.activeView.cid===i.cid||_.isEmpty(this.activeView))&&(e=!0))},this),e&&t.trigger("ask:click")},enableMonthly:function(){this.children.each(function(e){var t=e.model.get("frequency");_.isUndefined(t)||"monthly"!==t||e.model.set({active:!0})})},userSelectedAsk:function(e){_.isUndefined(e.model)||!0===e.model.get("active")&&(cure.donate.app.vent.trigger("user:clicked:ask",e.model),this.highlightAskItem(e))},highlightAskItem:function(e){this.activeView=e,this.children.each(function(e){e.model.set({selected:!1})}),e.model.set({selected:!0}),this.render()},syncAskSelection:function(e){var t=!1,i=!1,n=_.pick(cure.donate.app.donation.attributes,["amount","currency","frequency"]);_.extend(n,e),this.children.each(function(e){var r=e.model.get("amount"),o=e.model.get("frequency"),s=e.model.get("type");_.isUndefined(r)||_.isUndefined(o)||("any"===s&&(i=e),r===n.amount&&o===n.frequency&&(t=!0,this.activeView.cid!==e.cid&&this.highlightAskItem(e)))},this),t||!1===i||(_.isUndefined(n.amount)&&(n.amount=cure.donate.app.donation.get("amount")),i.model.set(n),this.highlightAskItem(i))}}),e.HeroStepOne=Backbone.Marionette.LayoutView.extend({template:"#HeroStepOne",initialize:function(){var e,t;e=new Backbone.Collection(cure.donate.app.Asks,{model:cure.donate.models.Ask}),(t=new cure.donate.views.HeroAsksCollectionView({collection:e,template:"#DonateAsks"})).on("next:step",_.bind(function(){this.nextStep()},this)),this.asksView=t},regions:{stepOneAsks:"#StepOneAsks"},events:{"click .btn-donate-continue":"nextStep"},animate:function(e){this.$el.show(),"in"===e&&animate({el:this.$el,opacity:[0,1],translateX:[-100,0],rotateY:[-30,0],easing:"easeOutQuad",delay:250,duration:500,complete:_.bind(function(){$("body").removeClass("step-2-active"),$("body").addClass("step-1-active")},this)}),"in:from:step:two"===e&&($("body").removeClass("step-2-active"),$("body").addClass("step-1-active"),animate({el:this.$el,opacity:[0,1],translateX:[-100,0],rotateY:[-30,0],easing:"easeOutQuad",delay:250,duration:500,complete:_.bind(function(){},this)})),"out"===e&&animate({el:this.$el,opacity:[1,0],translateX:[0,-100],rotateY:[0,-30],easing:"easeInQuad",delay:100,duration:250,complete:_.bind(function(){$("body").removeClass("step-1-active"),$("body").addClass("step-2-active"),this.$el.hide()},this)})},nextStep:function(e){this.animate("out"),this.triggerMethod("next:step")},onRender:function(){this.$el.hide(),this.$el.css({opacity:0}),this.stepOneAsks.show(this.asksView)},onAttach:function(){this.animate("in")}}),e.HeroStepTwo=Backbone.Marionette.LayoutView.extend({template:"#HeroStepTwo",initialize:function(){this.navigation=new cure.donate.views.HeroNavigation,this.navigation.on("go:back",_.bind(function(){this.triggerMethod("previous:step")},this)),this.amountView=new cure.donate.views.HeroAmountView({model:cure.donate.app.donation}),this.frequencyView=new cure.donate.views.HeroFrequencyView({model:cure.donate.app.donation}),this.stripeForm=new cure.donate.views.StripeForm({model:new cure.donate.models.stripeCard}),this.submitView=new cure.donate.views.HeroSubmitView({model:cure.donate.app.donation});var e=_.first(cure.donate.app.Asks);cure.donate.app.vent.trigger("user:clicked:ask",new cure.donate.models.Ask(e))},regions:{stepTwoNavigation:"#StepTwoNavigation",stepTwoAmount:"#StepTwoAmount",stepTwoFrequency:"#StepTwoFrequency",stepTwoStripeForm:"#StepTwoStripeForm",stepTwoSubmit:"#StepTwoSubmit"},events:{},animate:function(e){this.$el.show(),"in"===e&&animate({el:this.$el,opacity:[0,1],translateX:[120,0],rotateY:[25,0],easing:"easeOutQuad",delay:250,duration:500,complete:_.bind(function(){$("body").removeClass("step-1-active"),$("body").addClass("step-2-active")},this)}),"out"===e&&animate({el:this.$el,opacity:[1,0],translateX:[0,120],rotateY:[0,40],easing:"easeInQuad",delay:100,duration:250,complete:_.bind(function(){this.$el.hide()},this)})},onRender:function(){this.$el.hide(),this.$el.css({opacity:0}),this.stepTwoNavigation.show(this.navigation),this.stepTwoAmount.show(this.amountView),this.stepTwoFrequency.show(this.frequencyView),this.stepTwoStripeForm.show(this.stripeForm),this.stepTwoSubmit.show(this.submitView)}}),e.HeroLayout=Backbone.Marionette.LayoutView.extend({template:"#HeroWidgetLayout",initialize:function(){},regions:function(){var e={},t=[1,2];return _.each(t,function(t,i){e["zone"+t]="#zone-"+t},this),e},onAttach:function(){$('input[type="text"], input[type="email"]').blur(function(){0!=$(this).val().length?$(this).siblings("label").addClass("input-has-text"):$(this).siblings("label").removeClass("input-has-text")})}}),e.HeroNavigation=Backbone.Marionette.ItemView.extend({template:"#HeroNavigation",triggers:{click:"go:back"}}),e.HeroAmountView=e.Form.extend({initialize:function(){e.HeroAmountView.__super__.initialize.call(this)},template:"#Amount",templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),e}}),e.HeroFrequencyView=e.FrequencyView.extend({template:"#HeroFrequency",templateHelpers:function(){var e={};return _.extend(e,cure.donate.genericTemplateHelpers),e}}),e.HeroSubmitView=e.SubmitView.extend({}),e.HeroAskItem=Backbone.Marionette.ItemView.extend({initialize:function(){this.active=!0},tagName:"button",template:"#AskItem",className:function(){var e="giving-option";return!0===this.model.get("selected")&&(e+=" selected"),e},events:{click:function(e){if(!($(e.currentTarget).find(".giving-option-custom-input").length<=0))return!1;this.trigger("ask:click")},"keyup input[name=giving-option-custom-input]":function(e){var t={amount:e.currentTarget.value};cure.donate.app.vent.trigger("donation:data:change",t)}}}),e.HeroAsksCollectionView=e.AsksCollectionView.extend({childView:e.HeroAskItem,childViewContainer:".asks-container",className:"giving-options-container",events:{"click .btn-donate-continue":function(e){this.triggerMethod("next:step")}},childEvents:{"ask:click":function(e){e.$el.find(".giving-option-custom-input").length<=0&&this.triggerMethod("next:step")}}}),e.CurekidView=Backbone.Marionette.ItemView.extend({template:"#CurekidView",className:"child-selection-unit",templateHelpers:{getPhotoUrl:function(){var e=_.pluck(this,["header_photo_url","profile_photo_url","after_photo_url","before_photo_url"]);if(e=_.find(e,_.identity),photos.push("/img/curekids/questionmark-2.jpg"),!_.isEmpty(photo))return _.first(photos)},getTitleCase:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},getAge:function(){return 0===parseInt(this.age,10)?"Infant":this.age+" years"}},triggers:{click:"kid:click"}}),e.CurekidGivingMiniProfileView=e.CurekidView.extend({template:"#CurekidGivingMiniProfile",className:""}),e.KidsCollectionView=Backbone.Marionette.CompositeView.extend({template:"#KidContainer",childViewContainer:".child-selection",childView:e.CurekidView,className:"",initialize:function(){this.on("childview:kid:click",this.changeSelected)},changeSelected:function(e){this.$el.find(".child-selection-unit.selected").removeClass("selected"),e.$el.addClass("selected"),cure.donate.app.vent.trigger("donation:data:change",{profile_id:e.model.get("profile_id")}),cure.donate.app.vent.trigger("change:kid:selected",e)}}),e.donateDescriptionTop=Backbone.Marionette.ItemView.extend({template:"#DonateDescriptionCurekidTop",initialize:function(){cure.donate.app.vent.on("change:kid:selected",this.changeSelectedKid,this)},changeSelectedKid:function(e){this.model=e.model,this.render()}}),e.donateDescriptionBottom=Backbone.Marionette.ItemView.extend({template:"#DonateDescriptionCurekidBottom",initialize:function(){cure.donate.app.vent.on("change:kid:selected",this.changeSelectedKid,this)},changeSelectedKid:function(e){this.model=e.model,this.render()}}),e.donateAboveAsks=e.Form.extend({template:"#DonateAboveAsks",initialize:function(){},onRender:function(){var e=this.$el.find("#visible_event_date");!_.isUndefined($.fn.datepicker)&&e.length>0&&e.datepicker({altFormat:$.datepicker.ISO_8601,altField:"#event_date",onSelect:_.bind(function(){cure.donate.app.vent.trigger("donation:data:change",{event_date:this.$el.find("#event_date").val()})},this)})}}),e}(),void 0===cure)var cure={};$(function(){"use strict";cure.donate=cure.donate||{},cure.donate.genericTemplateHelpers={selected:function(e,t){return this[e]===t?'selected="selected"':""},checked:function(e,t){return $.parseJSON(this[e])===t?'checked="checked"':""},getStates:function(){return cure.donate.app.States}},cure.parseAndroidExpiry=function(e){return navigator.userAgent.match(/Android/i)&&e.indexOf("/")<0&&(length=e.length,3===length&&(e="0"+e.substr(0,1)+"/"+e.substr(1,2)),4===length&&(e=e.substr(0,2)+"/"+e.substr(2,2)),5===length&&(e="0"+e.substr(0,1)+"/"+e.substr(1,4)),6===length&&(e=e.substr(0,2)+"/"+e.substr(2,4))),e},cure.donate.app=function(){var e=new Backbone.Marionette.Application;return e.addRegions({mainRegion:"#donate-app",secondaryColumn:"#giving-mini-profile"}),e.addInitializer(function(t){var i={displayStyle:"full",paymentTypes:["stripe"],requireCvc:!0,isThankyou:!1,isAdmin:!1,showAddress:!1,showAllConcertKids:!1,showAsks:!0,showComment:!1,showEventDate:!1,showLearnMore:!1,showPhone:!1,showPrompts:!1,showIncentiveFlag:!1,showShirt:!1,showTest:!1,selectCommunity:!1,selectCountry:!1,selectCurekid:!1,giftMinimum:5,prompts:{aboveAsks:"",belowAsks:"",aboveEmail:"",belowEmail:"",aboveCard:"",aboveComment:"",belowComment:""}},n=["cure_donate_asks","cure_donate_curekids","cure_myaccount_user","cure_donation","cure_donate_states","cure_wp_user"];_.each(n,function(e){_.isArray(window[e])&&(window[e]=window[e].shift())}),_.extend(this.options={},i,t),_.extend(Backbone.Validation.callbacks,{valid:function(e,t,i){e.$("["+i+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,i,n,r){t.$("["+r+'~="'+i+'"]').addClass("invalid").attr("data-error",n);var o=new cure.donate.views.Message({model:new cure.donate.models.DonationMessageModel({type:"form_invalid",message:n})});e.vent.trigger("show:message",o)}}),this.Asks=[],this.Curekids=[],this.donation=new cure.donate.models.CureDonation,this.States=[],this.User=new Backbone.Model,"undefined"!=typeof cure_donate_asks&&(this.Asks=cure_donate_asks),"undefined"!=typeof cure_donate_curekids?_.isEmpty(cure_donate_curekids)||(this.options.selectCurekid=!0,this.Curekids=new cure.donate.collections.Curekids(cure_donate_curekids)):this.options.selectCurekid=!1,"undefined"!=typeof cure_donation&&(this.donation=new cure.donate.models.CureDonation(cure_donation),_.extend(this.options,this.donation.get("displayOptions")),_.extend(this.options.prompts,this.donation.get("prompts"))),"undefined"!=typeof cure_donate_states&&(this.States=cure_donate_states),"undefined"!=typeof cure_wp_user&&(this.User.set(cure_wp_user),this.donation.set({user_id:this.User.get("ID")}))}),e.setupUrlParams=function(){var t,i=$.url.paramAll(),n=new cure.donate.models.Ask({amount:"38",currency:cure.donate.app.donation.get("currency"),frequency:"monthly",type:"preset"}),r={},o=!1,s=!1,a=["amount","frequency"],c=["name","phone","first_name","last_name","email","community","community_id","campaign","gift_source","batch","zip","test","xid"];$.isEmptyObject(i)||(_.isUndefined(i.cvc)||(cure.donate.app.options.requireCvc="false"!==i.cvc,e.vent.trigger("toggle:cvc:requirement",cure.donate.app.options.requireCvc)),_.each(a,function(e){var t={};_.isUndefined(i[e])||(t[e]=i[e],n.set(t),o=!0)},this),_.each(c,function(e){var t={};_.isUndefined(i[e])||(t[e]=i[e],"community"===e&&(t.community_id=""),"xid"===e&&(t.xcontact_id=i[e]),_.extend(r,t),s=!0)},this),$("select[name=community_id]").length>0&&!_.isUndefined(i.community)&&(t=$("select[name=community_id] option:contains("+decodeURIComponent(i.community.replace(/\+/g," "))+")").val(),_.isUndefined(t)||$("select[name=community_id]").val(t)),e.vent.trigger("donation:data:change",r),o&&(this.asksInitialized=!0,e.vent.trigger("changed:ask:field",n.attributes),e.vent.trigger("user:clicked:ask",n)),_.isUndefined(i.paytype)||e.vent.trigger("change:paytype:byname",i.paytype))},e.onStart=function(t){e.vent.on("toggle:test:mode",function(e){var t=!1,i=!1;_.isUndefined(e.test)||"true"!=e.test||(t=!0),(document.URL.indexOf("127.")>-1||document.URL.indexOf("192.")>-1||document.URL.indexOf("local")>-1||document.URL.indexOf("beta")>-1)&&(i=!0),i?(console.log("Dev mode"),cure.donate.app.donation.set({test:!1}),Stripe.setPublishableKey("pk_test_UzJylWXWA4SUtuQ7kTuXbpQh")):!i&&t?(console.log("Test mode"),cure.donate.app.options.showTest=!0,Stripe.setPublishableKey("pk_test_UzJylWXWA4SUtuQ7kTuXbpQh")):Stripe.setPublishableKey("pk_live_kpS3IntlZuXelapRe2WwhQYT")}),e.vent.trigger("toggle:test:mode",{test:cure.donate.app.donation.get("test")}),cure.donate.app.vent.on("donation:data:change",function(e){this.donation.set(e)},this),"widget"===e.options.displayStyle?e.module("Widget").start(t):"hero"===e.options.displayStyle?e.module("Hero").start(t):e.module("Full").start(t)},e.module("Full",function(e,t,i,n,r,o){e.startWithParent=!1,e.addInitializer(function(t){e.Controller=new s(t)});var s=i.Marionette.Controller.extend({initialize:function(e){var n,s,a,c=["fund","campaign_id","dedication_type","community_id","Shirt_Size__c"],d=["recipient_name","recipient_email"];if(this.paymentTypeInitialized=!1,this.asksInitialized=!1,t.vent.on("change:payment:type",this.changePaymentTypeByView,this),t.vent.on("change:paytype:byname",this.changePaymentTypeByName,this),t.vent.on("show:message",this.showMessage,this),t.vent.on("change:kid:selected",this.updateKid,this),this.layout=new cure.donate.views.fullLayout,t.mainRegion.show(this.layout),this.renderTabs(),n=new i.Collection(t.Asks,{model:cure.donate.models.Ask}),this.asksView=new cure.donate.views.AsksCollectionView({collection:n}),this.layout.zone4.show(this.asksView),this.amountView=new cure.donate.views.AmountView({model:cure.donate.app.donation}),this.layout.zone5.show(this.amountView),this.frequencyView=new cure.donate.views.FrequencyView({model:cure.donate.app.donation}),this.layout.zone6.show(this.frequencyView),this.extrasForm=new cure.donate.views.CureExtrasForm({model:cure.donate.app.donation}),this.layout.zone11.show(this.extrasForm),this.submitView=new cure.donate.views.SubmitView({model:cure.donate.app.donation}),this.layout.zone12.show(this.submitView),s=this.navPaymentTypes.pluck("paytype"),a={stripe:{name:"StripeForm",template:"StripeForm",model:"stripeCard"},giftcard:{name:"GiftCardForm",template:"",model:"GiftCard"},cash:{name:"CashForm",template:"",model:cure.donate.app.donation}},o.each(s,function(e,t){var i,n=a[e],r={};i=n.name.charAt(0).toLowerCase()+n.name.slice(1),o.isString(n.model)?r.model=new cure.donate.models[n.model]:r.model=n.model,o.isEmpty(n.template)||(r.template=n.template),this[i]=new cure.donate.views[n.name](r)},this),!0===t.options.selectCurekid&&t.Curekids){var u=new cure.donate.views.donateDescriptionTop,h=new cure.donate.views.donateDescriptionBottom,l=new cure.donate.views.KidsCollectionView({collection:t.Curekids});this.layout.zone1.show(u),this.layout.zone3.show(h),this.layout["zone2-2"].show(l),l.children.first().trigger("kid:click")}if(!0===t.options.showEventDate){var p=new cure.donate.views.donateAboveAsks;this.layout.zone2.show(p)}o.each(c,function(e){var i=r("select[name="+e+"]"),n={};i.length>0&&(i.val()&&(n[e]=i.val(),t.vent.trigger("donation:data:change",n)),i.on("change",function(e){var i={};i[e.currentTarget.name]=e.currentTarget.value,t.vent.trigger("donation:data:change",i)}))},this),o.each(d,function(e){var i=r("input[name="+e+"]"),n={};i.length>0&&(i.val()&&(n[e]=i.val(),t.vent.trigger("donation:data:change",n)),i.on("change",function(e){var i={};i[e.currentTarget.name]=e.currentTarget.value,t.vent.trigger("donation:data:change",i)}))},this),this.asksInitialized||this.asksView.children.first().trigger("ask:click"),this.paymentTypeInitialized||this.navView.children.first().trigger("change:payment:type"),!1===cure.donate.app.options.requireCvc&&t.vent.trigger("toggle:cvc:requirement",cure.donate.app.options.requireCvc),cure.donate.app.setupUrlParams()},renderTabs:function(){var e=[{id:"credit-card",form:"StripeForm",paytype:"stripe",label:"Credit Card",iconClass:"",spanClass:""},{id:"gift-card",form:"GiftCardForm",paytype:"giftcard",label:"Gift Card",iconClass:"",spanClass:""},{id:"cash",form:"CashGiftForm",paytype:"cash",label:"Cash/Check",iconClass:"",spanClass:""}];this.navPaymentTypes=new i.Collection,o.each(e,function(e){o.contains(t.options.paymentTypes,e.paytype)&&this.navPaymentTypes.add(e)},this),this.navView=new cure.donate.views.navMenu({collection:this.navPaymentTypes}),this.layout.zone7.show(this.navView)},changePaymentTypeByName:function(e){var t=!1;"check"===e&&(t=!0,e="cash"),this.navView.children.each(function(i){i.model.get("paytype")===e&&(this.paymentTypeInitialized=!0,t&&i.model.set({paytype:"check"}),i.trigger("change:payment:type"))},this)},changePaymentTypeByView:function(e){var i=e.get("paytype"),n=new cure.donate.models.Ask,r=!1;this.layout.zone13.reset(),t.donation.set({paymentType:i,gift_source:i}),n.set(o.first(cure.donate.app.Asks)),"stripe"===i&&this.layout.zone8.show(this.stripeForm,{preventDestroy:!0}),"giftcard"===i&&(n.set({amount:"25",currency:"usd",frequency:"once",type:"any"}),this.layout.zone8.show(this.giftCardForm,{preventDestroy:!0}),r=!0),"cash"!==i&&"check"!==i||(this.cashForm.paymentType=i,this.cashForm.model.set({gift_source:i}),this.layout.zone8.show(this.cashForm,{preventDestroy:!0}),this.cashForm.render(),r=!0),"cash"!==i&&"check"!==i&&t.vent.trigger("changed:ask:field",n.attributes),r?t.vent.trigger("hide:monthly:asks"):t.vent.trigger("show:monthly:asks")},showMessage:function(e){r("#donate_please_wait").length>0&&r("#donate_please_wait").modal("hide"),this.layout.zone13.show(e)},updateKid:function(e){var i=new cure.donate.views.CurekidGivingMiniProfileView({model:e.model});t.secondaryColumn.show(i)}})}),e.module("Widget",function(e,t,i,n,r,o){e.startWithParent=!1,e.addInitializer(function(){e.Controller=new s});var s=i.Marionette.Controller.extend({initialize:function(){var e,i;this.layout=new cure.donate.views.widgetLayout,t.mainRegion.show(this.layout),this.layout.widgetHeader.show(new cure.donate.views.widgetLayoutTop({model:cure.donate.app.donation})),e=new cure.donate.views.StripeForm({model:new cure.donate.models.stripeCard}),this.layout.widgetForm.show(e),this.layout.widgetFooter.show(new cure.donate.views.widgetLayoutBottom({model:cure.donate.app.donation})),this.submitView=new cure.donate.views.SubmitView({model:cure.donate.app.donation}),this.layout.widgetSubmit.show(this.submitView),cure.donate.app.donation.set({paymentType:"stripe",gift_source:"stripe"}),i=o.first(cure.donate.app.Asks),t.vent.trigger("user:clicked:ask",new cure.donate.models.Ask(i)),cure.donate.app.setupUrlParams(),t.vent.on("show:message",this.showMessage,this)},showMessage:function(e){this.layout.widgetError.show(e)}})}),e.module("Hero",function(e,t,i,n,r,o){e.startWithParent=!1,e.addInitializer(function(){e.Controller=new s});var s=i.Marionette.Controller.extend({initialize:function(){cure.donate.app.donation.set({paymentType:"stripe"}),this.layout=new cure.donate.views.HeroLayout,cure.donate.app.mainRegion.show(this.layout),this.stepOne=new cure.donate.views.HeroStepOne,this.stepOne.on("next:step",o.bind(function(){this.stepTwo.animate("in")},this)),this.layout.zone1.show(this.stepOne),this.stepTwo=new cure.donate.views.HeroStepTwo,this.stepTwo.on("previous:step",o.bind(function(){this.stepTwo.animate("out"),o.delay(o.bind(function(){this.stepOne.animate("in:from:step:two")},this),300)},this)),this.layout.zone2.show(this.stepTwo),cure.donate.app.Asks.length<=1&&this.stepTwo.animate("in")}})}),e}(),$("#donate-app").length>0&&cure.donate.app.start()});